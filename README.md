# Parking Environment Demo

This repository packages a modular parking environment, ready for interactive demos and steering-assist tuning. The workflow is built around a Conda environment (`parking-rl`) and a Jupyter notebook that orchestrates the individual scripts.

## Environment

- Conda version used: **25.7.0** (from Anaconda/Miniconda).
- Environment definition: [`environment.yml`](environment.yml).

Recreate the environment on a new machine:

```bash
conda env create -f environment.yml
conda activate parking-rl
python -m ipykernel install --user --name parking-rl --display-name "python3 (parking-rl)"
```

If the environment already exists:

```bash
conda env update -f environment.yml --prune
conda activate parking-rl
```

Key packages pulled in by the environment include Gymnasium 0.29.1 and **PyTorch 2.2.2 (CPU build)** for the upcoming PPO training notebook. Ensure Qt GUI support is available (the environment installs `pyqt>=5.15`). On headless Linux hosts you may need to export `QT_QPA_PLATFORM=offscreen` or use X11 forwarding. The environment also bundles the classic Jupyter Notebook server so you can launch the demo straight from this Conda env.

Launch Jupyter against this environment: when opening `ParkingEnv_Demo.ipynb`, pick the kernel shown as `python3 (parking-rl)` so the notebook runs inside the freshly created environment.

## Project Layout

```
parking_project/
â”œâ”€â”€ generate_training_config.py   # CLI to synthesize random training configs
â”œâ”€â”€ main.py                       # CLI entry point for manual/random parking runs
â”œâ”€â”€ parking_gym.py                # Gymnasium environment definition and helpers
â”œâ”€â”€ assist_model_tuner.py         # Qt-backed Matplotlib tuner for steering/velocity assists
â”œâ”€â”€ generated_configs/
â”‚   â”œâ”€â”€ notebook_override.json    # Live-config edited by the notebook/tuner
â”‚   â””â”€â”€ train_001.json            # Sample training config generated by CLI
â””â”€â”€ ParkingEnv_Demo.ipynb         # Notebook front-end controlling the entire demo

README.md                         # This file
environment.yml                   # Conda environment specification
```

The workflow is modular: JSON configs capture scenario parameters, the notebook drives high-level actions, and standalone scripts handle CLI demos and steering tuning.

### Default Scenario Snapshot

- `dt = 0.1 s`, `max_steps = 4000` per episode.
- Field is a 60 m Ã— 60 m square, spawn region defaults to `[-6, 6]` in both axes.
- Nine lidar rays (angles `[-135, -90, -60, -30, 30, 60, 90, 135, 0]` degrees) extend to 12 m and contribute to the observation vector.
- Vehicle assist tuning defaults: steering limits Â±60Â° at Â±30Â°/s, steering assist gains `Kp=52.5`, `Kd=8.75`, deadband 0.03 rad/sÂ², longitudinal damping gain 2.45 with 0.03 m/s deadband, assist enabled by default.
- Observation noise is enabled with Ïƒ=0.005; call `env.unwrapped.set_observation_noise(enabled=False)` for evaluation runs.

`parking_gym.DEFAULT_CONFIG` is the single source of truth for these values; the notebookâ€™s `generated_configs/notebook_override.json` mirrors the same defaults but is safe to edit interactively.

## Usage

### 1. Launch the Notebook

Within the activated environment:

```bash
cd parking_project
jupyter notebook ParkingEnv_Demo.ipynb
```

The notebook guides you through:

1. Setting run parameters (episodes, max steps, mode).
2. Choosing or editing configuration JSON files.
3. Launching the assist-model tuner (`assist_model_tuner.py`) with Qt sliders for steering/velocity assists.
4. Starting the CLI parking demo (`main.py`) in manual or random mode.
5. Inspecting environment usage tips (state/action layout, observation noise switches) in the final Markdown cell.

All key actions (writing configs, spawning CLI commands) are exposed as notebook cells; no direct script editing is required for normal usage.

### 2. Assist-Model Tuning (Command Line)

You can also launch the tuner from a terminal:

```bash
conda run -n parking-rl python assist_model_tuner.py \
  --config generated_configs/notebook_override.json \
  --angle0 20 --rate0 0 --steps 200 --sync
```

Sliders adjust the steering return and velocity damping assists; when `--sync` is supplied, each adjustment writes back to the JSON file.

### 3. CLI Parking Demo

Run manual or random episodes without the notebook:

```bash
conda run -n parking-rl python main.py \
  --mode manual --episodes 1 --max-steps 4000 \
  --config generated_configs/notebook_override.json
```

Optional flags:

- `--mode random` for scripted random-agent control.
- `--sleep-scale <float>` to slow down or speed up animation.

### 4. Training Config Generator

Produce a fresh randomized config (scene geometry onlyâ€”timing, vehicle limits, and lidar layout remain at the tuned defaults):

```bash
conda run -n parking-rl python generate_training_config.py \
  --out generated_configs/train_001.json
```

## Notes for Contributors

- The repo targets Python 3.8 for compatibility with Gymnasium 0.29.
- GUI windows rely on Matplotlibâ€™s `QtAgg` backend.
- JSON configs embed bilingual notes; the assist-model tuner preserves UTF-8 characters on write.
- `generate_training_config.py` deep-copies `DEFAULT_CONFIG` and only randomizes spawn/slot/obstacle fields so controller-related tuning stays centralized.
- If you adjust parameters outside the notebook, ensure `--sync` is enabled when tuning to keep the JSON file up to date.

Happy parking!


# åœè½¦ç¯å¢ƒæ¼”ç¤ºé¡¹ç›®ï¼ˆParking Environment Demoï¼‰

è¿™æ˜¯ä¸€ä¸ª**æ¨¡å—åŒ–çš„åœè½¦ç¯å¢ƒä»¿çœŸé¡¹ç›®**ï¼Œå¯ç”¨äºäº¤äº’å¼æ¼”ç¤ºã€è¾…åŠ©è½¬å‘æ§åˆ¶è°ƒè¯•ç­‰ä»»åŠ¡ã€‚  
æ•´ä¸ªæµç¨‹åŸºäº Conda ç¯å¢ƒ (`parking-rl`) æ„å»ºï¼Œé€šè¿‡ Jupyter Notebook æ¥ç»Ÿä¸€è°ƒç”¨å„ä¸ªè„šæœ¬ã€‚

---

## ç¯å¢ƒé…ç½®

- Conda ç‰ˆæœ¬ï¼š**25.7.0**ï¼ˆAnaconda / Miniconda å‘è¡Œç‰ˆï¼‰
- ç¯å¢ƒå®šä¹‰æ–‡ä»¶ï¼š[`environment.yml`](environment.yml)

åœ¨æ–°æœºå™¨ä¸Šé‡æ–°åˆ›å»ºç¯å¢ƒï¼š

```bash
conda env create -f environment.yml
conda activate parking-rl
python -m ipykernel install --user --name parking-rl --display-name "python3 (parking-rl)"
````

å¦‚æœç¯å¢ƒå·²å­˜åœ¨ï¼š

```bash
conda env update -f environment.yml --prune
conda activate parking-rl
```

ä¸»è¦ä¾èµ–åŒ…æ‹¬ Gymnasium 0.29.1 ä»¥åŠ **PyTorch 2.2.2ï¼ˆCPU ç‰ˆæœ¬ï¼‰**ï¼Œåç»­çš„ PPO è®­ç»ƒ Notebook ä¼šä½¿ç”¨å®ƒæ¥æ„å»ºç­–ç•¥ç½‘ç»œã€‚
ç³»ç»Ÿéœ€æ”¯æŒ Qt å›¾å½¢ç•Œé¢ï¼ˆç¯å¢ƒå·²åŒ…å« `pyqt>=5.15`ï¼‰ã€‚
è‹¥åœ¨æ— ç•Œé¢çš„ Linux ç¯å¢ƒä¸­è¿è¡Œï¼Œå¯è®¾ç½®ï¼š

```bash
export QT_QPA_PLATFORM=offscreen
```

æˆ–ä½¿ç”¨ X11 è½¬å‘ã€‚

è¯¥ç¯å¢ƒè‡ªå¸¦ Jupyter Notebookï¼Œå¯ç›´æ¥æ‰“å¼€å¹¶è¿è¡Œã€‚
æ‰“å¼€ `ParkingEnv_Demo.ipynb` æ—¶è¯·é€‰æ‹©å†…æ ¸ï¼š
**`python3 (parking-rl)`**ï¼Œç¡®ä¿åœ¨æ­£ç¡®ç¯å¢ƒä¸­è¿è¡Œã€‚

---

## é¡¹ç›®ç»“æ„

```
parking_project/
â”œâ”€â”€ generate_training_config.py   # ç”Ÿæˆéšæœºè®­ç»ƒé…ç½®æ–‡ä»¶
â”œâ”€â”€ main.py                       # å‘½ä»¤è¡Œå…¥å£ï¼ˆæ‰‹åŠ¨/éšæœºåœè½¦æ¨¡å¼ï¼‰
â”œâ”€â”€ parking_gym.py                # Gymnasium ç¯å¢ƒå®šä¹‰ä¸è¾…åŠ©å‡½æ•°
â”œâ”€â”€ assist_model_tuner.py         # Qt + Matplotlib è¾…åŠ©æ§åˆ¶è°ƒèŠ‚ç•Œé¢
â”œâ”€â”€ generated_configs/
â”‚   â”œâ”€â”€ notebook_override.json    # ç”± Notebook å®æ—¶ä¿®æ”¹çš„é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ train_001.json            # ç”±å‘½ä»¤è¡Œç”Ÿæˆçš„ç¤ºä¾‹é…ç½®
â””â”€â”€ ParkingEnv_Demo.ipynb         # Notebook å‰ç«¯ï¼Œæ•´åˆæ‰€æœ‰åŠŸèƒ½

README.md                         # æœ¬æ–‡ä»¶
environment.yml                   # Conda ç¯å¢ƒå®šä¹‰æ–‡ä»¶
```

é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼š

* JSON é…ç½®æ–‡ä»¶è®°å½•åœºæ™¯ä¸å‚æ•°ï¼›
* Notebook è´Ÿè´£é«˜å±‚æ§åˆ¶ä¸äº¤äº’ï¼›
* å„è„šæœ¬è´Ÿè´£å‘½ä»¤è¡Œæ¼”ç¤ºä¸è°ƒå‚å·¥å…·ã€‚

---

## é»˜è®¤åœºæ™¯å‚æ•°

* æ—¶é—´æ­¥é•¿ï¼š`dt = 0.1 s`ï¼Œæ¯å›åˆæœ€å¤§æ­¥æ•° `max_steps = 4000`
* åœºåœ°å¤§å°ï¼š60 m Ã— 60 mï¼Œè½¦è¾†åˆå§‹åŒºåŸŸ `[-6, 6] Ã— [-6, 6]`
* ä¹æŸæ¿€å…‰é›·è¾¾ï¼šè§’åº¦ `[-135, -90, -60, -30, 30, 60, 90, 135, 0]`Â°ï¼Œæœ€å¤§æµ‹è· 12 m
* è½¬å‘èŒƒå›´ï¼šÂ±60Â°ï¼Œè§’é€Ÿåº¦ Â±30Â°/s
* è½¬å‘è¾…åŠ©å‚æ•°ï¼š`Kp=52.5`, `Kd=8.75`, æ­»åŒº 0.03 rad/sÂ²
* çºµå‘é˜»å°¼å‚æ•°ï¼š`K=2.45`ï¼Œé€Ÿåº¦æ­»åŒº 0.03 m/s
* é»˜è®¤å¯ç”¨è¾…åŠ©æ§åˆ¶
* è§‚æµ‹å™ªå£°ï¼šÏƒ=0.005ï¼ˆå¯é€šè¿‡ `env.unwrapped.set_observation_noise(enabled=False)` å…³é—­ï¼‰

è¿™äº›é»˜è®¤å€¼åœ¨ `parking_gym.DEFAULT_CONFIG` ä¸­å®šä¹‰ã€‚
Notebook ä½¿ç”¨çš„ `generated_configs/notebook_override.json` ä¸å…¶ä¿æŒåŒæ­¥ï¼Œå¯å®‰å…¨ä¿®æ”¹ã€‚

---

## ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨ Notebook

```bash
cd parking_project
jupyter notebook ParkingEnv_Demo.ipynb
```

Notebook ä¼šå¼•å¯¼ä½ å®Œæˆï¼š

1. è®¾ç½®è¿è¡Œå‚æ•°ï¼ˆå›åˆæ•°ã€æ­¥æ•°ã€æ¨¡å¼ç­‰ï¼‰
2. é€‰æ‹©æˆ–ç¼–è¾‘é…ç½®æ–‡ä»¶
3. å¯åŠ¨è¾…åŠ©æ¨¡å‹è°ƒèŠ‚å™¨ (`assist_model_tuner.py`)
4. å¯åŠ¨åœè½¦æ¼”ç¤º (`main.py`)
5. æŸ¥çœ‹ç¯å¢ƒä½¿ç”¨æŠ€å·§ï¼ˆçŠ¶æ€/åŠ¨ä½œç©ºé—´ã€å™ªå£°æ§åˆ¶ç­‰ï¼‰

---

### 2. å‘½ä»¤è¡Œæ–¹å¼è°ƒèŠ‚è¾…åŠ©æ¨¡å‹

```bash
conda run -n parking-rl python assist_model_tuner.py \
  --config generated_configs/notebook_override.json \
  --angle0 20 --rate0 0 --steps 200 --sync
```

æ»‘å—å¯å®æ—¶è°ƒèŠ‚è½¬å‘å›æ­£ä¸é€Ÿåº¦é˜»å°¼ï¼›
åŠ ä¸Š `--sync` å‚æ•°æ—¶ï¼Œè°ƒæ•´ç»“æœä¼šè‡ªåŠ¨å†™å› JSON æ–‡ä»¶ã€‚

---

### 3. å‘½ä»¤è¡Œåœè½¦æ¼”ç¤º

```bash
conda run -n parking-rl python main.py \
  --mode manual --episodes 1 --max-steps 4000 \
  --config generated_configs/notebook_override.json
```

å¯é€‰å‚æ•°ï¼š

* `--mode random`ï¼šä½¿ç”¨éšæœºæ§åˆ¶å™¨
* `--sleep-scale <float>`ï¼šè°ƒæ•´åŠ¨ç”»æ’­æ”¾é€Ÿåº¦

---

### 4. ç”Ÿæˆè®­ç»ƒé…ç½®æ–‡ä»¶

```bash
conda run -n parking-rl python generate_training_config.py \
  --out generated_configs/train_001.json
```

æ­¤å‘½ä»¤ä¼šåŸºäºé»˜è®¤é…ç½®éšæœºç”Ÿæˆæ–°åœºæ™¯ï¼ˆè½¦ä½ã€éšœç¢ç‰©ç­‰ï¼‰ï¼Œ
ä¸ä¼šä¿®æ”¹æ§åˆ¶å‚æ•°ï¼Œç¡®ä¿è°ƒè¯•ä¸€è‡´æ€§ã€‚

---

## å¼€å‘è€…æç¤º

* æ¨è Python ç‰ˆæœ¬ï¼š**3.8**ï¼ˆå…¼å®¹ Gymnasium 0.29ï¼‰
* å›¾å½¢ç•Œé¢ä¾èµ– Matplotlib çš„ `QtAgg` åç«¯
* JSON æ–‡ä»¶æ”¯æŒä¸­è‹±æ–‡æ³¨é‡Šå¹¶ä¿æŒ UTF-8 ç¼–ç 
* `generate_training_config.py` ä»…éšæœºåœºæ™¯éƒ¨åˆ†ï¼Œæ§åˆ¶å‚æ•°ä¿æŒä¸€è‡´
* è‹¥åœ¨ Notebook å¤–ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè¯·å¯ç”¨ `--sync` ä¿æŒåŒæ­¥

---

**ç¥ä½ è°ƒå‚é¡ºåˆ©ï¼Œåœè½¦æ— å¿§ï¼ğŸš—**
